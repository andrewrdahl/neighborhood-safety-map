<script>
/* --------------------------------------------------------------
   1Ô∏è‚É£ Initialise the map ‚Äì now using a bounding box
   -------------------------------------------------------------- */

// Create the map instance without a preset centre/zoom
const map = L.map('map');

// ---- 4 corner points (lat, lon) ----
const cornerPoints = [
  L.latLng(44.915980401831014, -93.29213180874551),
  L.latLng(44.93910303039243 , -93.29007482943638),
  L.latLng(44.93838777366788 , -93.27170636411634),
  L.latLng(44.91610817665654 , -93.2716702766504)
];

// Build a bounds object that encloses all corners
const bounds = L.latLngBounds(cornerPoints);

// Fit the map to those bounds (adds a little padding so points aren‚Äôt flush to the edge)
map.fitBounds(bounds, { padding: [30, 30] });   // 30‚ÄØpx padding on each side

// ---------------------------------------------------------------
// 2Ô∏è‚É£ Add the OSM basemap (must keep attribution)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution:
    '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
}).addTo(map);

/* --------------------------------------------------------------
   3Ô∏è‚É£ Load GPX routes (unchanged)
   -------------------------------------------------------------- */
fetch('data/routes-index.json')
  .then(r => r.json())
  .then(list => {
    list.forEach(fname => {
      new L.GPX(`data/${fname}`, {
        async: true,
        marker_options: {
          startIconUrl:
            'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
          shadowUrl:
            'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'
        }
      }).addTo(map);
    });
  })
  .catch(err => console.warn('No GPX routes loaded', err));

/* --------------------------------------------------------------
   4Ô∏è‚É£ Load point data (trash‚Äëcan locations, hazards, ‚Ä¶)
   -------------------------------------------------------------- */
const pointLayer = new L.GeoJSON.AJAX('data/points.geojson', {
  pointToLayer: (feature, latlng) => {
    const icon = L.divIcon({
      html: 'üóëÔ∏è',
      className: '',
      iconSize: [24, 24],
      iconAnchor: [12, 12]
    });
    return L.marker(latlng, { icon });
  },
  onEachFeature: (feature, layer) => {
    const p = feature.properties || {};
    let popup = `<strong>${p.name || 'Location'}</strong><br>${p.description || ''}`;
    if (p.photo) {
      popup += `<br><img src="${p.photo}" style="max-width:200px;">`;
    }
    layer.bindPopup(popup);
  }
}).addTo(map);
</script>
