<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Neighborhood Safety Map</title>

  <!-- Leaflet CSS (no integrity) -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <!-- Your own styling -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="map"></div>

<!-- Leaflet core JS (no integrity) -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Plugins -->
<script src="https://unpkg.com/leaflet-gpx@1.5.0/gpx.min.js"></script>
<script src="https://unpkg.com/leaflet-ajax@2.2.1/dist/leaflet.ajax.min.js"></script>

<script>
/* --------------------------------------------------------------
   1Ô∏è‚É£ Initialise the map
   -------------------------------------------------------------- */
const map = L.map('map').setView([40.7128, -74.0060], 13); // ‚Üê change to your neighbourhood centre

// OpenStreetMap basemap (must keep attribution)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution:
    '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
}).addTo(map);

/* --------------------------------------------------------------
   2Ô∏è‚É£ Load GPX routes
   -------------------------------------------------------------- */
// The file `data/routes-index.json` is a simple JSON array of GPX filenames.
// Example: ["walk-2025-12-01.gpx","walk-2025-12-08.gpx"]
fetch('data/routes-index.json')
  .then(r => r.json())
  .then(list => {
    list.forEach(fname => {
      new L.GPX(`data/${fname}`, {
        async: true,
        marker_options: {
          startIconUrl:
            'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
          shadowUrl:
            'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'
        }
      }).addTo(map);
    });
  })
  .catch(err => console.warn('No GPX routes loaded', err));

/* --------------------------------------------------------------
   3Ô∏è‚É£ Load point data (trash‚Äëcan locations, hazards, ‚Ä¶)
   -------------------------------------------------------------- */
// You can use either a GeoJSON file (`points.geojson`) or a CSV file (`points.csv`).
// The example below assumes GeoJSON. If you prefer CSV, just change the URL.
const pointLayer = new L.GeoJSON.AJAX('data/points.geojson', {
  pointToLayer: (feature, latlng) => {
    // Custom icon ‚Äì here a simple trash‚Äëcan emoji.
    const icon = L.divIcon({
      html: 'üóëÔ∏è',
      className: '',
      iconSize: [24, 24],
      iconAnchor: [12, 12]
    });
    return L.marker(latlng, { icon });
  },
  onEachFeature: (feature, layer) => {
    const p = feature.properties || {};
    let popup = `<strong>${p.name || 'Location'}</strong><br>${p.description || ''}`;
    if (p.photo) {
      popup += `<br><img src="${p.photo}" style="max-width:200px;">`;
    }
    layer.bindPopup(popup);
  }
}).addTo(map);
</script>
</body>
</html>
