<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Neighborhood Safety Map</title>
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-gpx@1.5.0/gpx.min.js"></script>
<script src="https://unpkg.com/leaflet-ajax@2.2.1/dist/leaflet.ajax.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* -------------------------------------------------------
     2.1 Initialise the map â€“ fit it to the four corner points
     ------------------------------------------------------- */
  const map = L.map('map');

  // ---- Four coordinates you supplied (lat, lon) ----
  const cornerPoints = [
    L.latLng(44.91967126612724, -93.27477257828512),
    L.latLng(44.93775563598858, -93.27469685260726),
    L.latLng(44.93770432963163, -93.2882217152788),
    L.latLng(44.91957619483672, -93.28835279135043)
  ];

  // Build a bounds object that encloses all four points
  const bounds = L.latLngBounds(cornerPoints);
  map.fitBounds(bounds, { padding: [30, 30] });

  /* -------------------------------------------------------
     2.2 **Add the polygon** that joins the four points
     ------------------------------------------------------- */
  const polygon = L.polygon(cornerPoints, {
    color: '#555555',       // border colour (dark gray)
    weight: 2,              // border thickness
    fillColor: '#dddddd',   // interior fill (light gray)
    fillOpacity: 0.3        // semiâ€‘transparent so the basemap shows through
  }).addTo(map);

  // Optional: a small popup that explains the shape
  polygon.bindPopup(
    '<strong>Patrol Area</strong><br>' +
    'These four points outline the region your safety club covers.'
  );

  /* -------------------------------------------------------
     2.3 Add the OpenStreetMap basemap (must keep attribution)
     ------------------------------------------------------- */
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution:
      '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
  }).addTo(map);

  /* -------------------------------------------------------
     2.4 Load GPX routes (if you have any)
     ------------------------------------------------------- */
  fetch('data/routes-index.json')
    .then(r => r.json())
    .then(list => {
      list.forEach(fname => {
        new L.GPX(`data/${fname}`, {
          async: true,
          marker_options: {
            startIconUrl:
              'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            shadowUrl:
              'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'
          }
        }).addTo(map);
      });
    })
    .catch(err => console.warn('No GPX routes loaded', err));

  /* -------------------------------------------------------
     2.5 Load point data (trashâ€‘cans, hazards, etc.)
     ------------------------------------------------------- */
  const pointLayer = new L.GeoJSON.AJAX('data/points.geojson', {
    pointToLayer: (feature, latlng) => {
      const icon = L.divIcon({
        html: 'ðŸ—‘ï¸',
        className: '',
        iconSize: [24, 24],
        iconAnchor: [12, 12]
      });
      return L.marker(latlng, { icon });
    },
    onEachFeature: (feature, layer) => {
      const p = feature.properties || {};
      let popup = `<strong>${p.name || 'Location'}</strong><br>${p.description || ''}`;
      if (p.photo) {
        popup += `<br><img src="${p.photo}" style="max-width:200px;">`;
      }
      layer.bindPopup(popup);
    }
  }).addTo(map);

}); // end DOMContentLoaded
</script>
</body>
</html>
